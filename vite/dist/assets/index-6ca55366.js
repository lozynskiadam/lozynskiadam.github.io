var Ut=Object.defineProperty;var Yt=(r,t,e)=>t in r?Ut(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var S=(r,t,e)=>(Yt(r,typeof t!="symbol"?t+"":t,e),e),Ft=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var g=(r,t,e)=>(Ft(r,t,"read from private field"),e?e.call(r):t.get(r)),R=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},I=(r,t,e,i)=>(Ft(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);var xt=(r,t,e,i)=>({set _(n){I(r,t,n,e)},get _(){return g(r,t,i)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const y of a.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&i(y)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const k=32,Rt=33,Mt=19,Xt="data/sprites.json",Vt="data/items.json",$t="data/effects.json";const Qt=function(r){return Math.floor(Math.random()*(r+1))},ut=function(r){return Qt(r)===r},Zt=function(r){return window.btoa(String.fromCharCode(...window.crypto.getRandomValues(new Uint8Array(r*2)))).replace(/[+/]/g,"").substring(0,r)},Pt=function(){return"#000000".replace(/0/g,function(){return(~~(Math.random()*16)).toString(16)})},Dt=function(r){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},Jt=function(r,t){Object.keys(t).forEach(n=>{t[Dt(n).toString()]=Dt(t[n]),delete t[n]});const e=document.createElement("canvas").getContext("2d");e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0);const i=e.getImageData(0,0,e.canvas.width,e.canvas.height);for(let n=0;n<i.data.length;n+=4){const a=[i.data[n],i.data[n+1],i.data[n+2]].toString();if(a in t){const y=t[a];i.data[n]=y[0],i.data[n+1]=y[1],i.data[n+2]=y[2],i.data[n+3]=255}}return e.putImageData(i,0,0),e.canvas},Bt=async function(r){return new Promise(t=>{const e=new Image;e.onload=()=>t(e),e.src=r})},_t=async function(r,t,e){return new Promise(i=>{if(!t)return r;const n=["#ff0000","#ff00ff","#0000ff","#ffff00","#00ffff","#ff00ff"],a={};e.forEach((O,C)=>{a[n[C]]=O});const y=Jt(t,a),w=document.createElement("canvas").getContext("2d");w.canvas.width=r.width,w.canvas.height=r.height,w.drawImage(r,0,0),w.globalCompositeOperation="overlay",w.drawImage(y,0,0);const A=new Image;A.onload=()=>i(A),A.src=w.canvas.toDataURL("image/png")})};var vt,kt,it,ct,ft,$,Y,U,pt,nt,st,Q,dt;const rt=class rt{constructor(t,e){R(this,kt,null);R(this,it,null);R(this,ct,null);R(this,ft,null);R(this,$,null);R(this,Y,null);R(this,U,null);R(this,pt,null);R(this,nt,null);R(this,st,null);R(this,Q,null);R(this,dt,null);t&&(g(rt,vt)[t]=this),I(this,kt,t),I(this,it,e.image),I(this,ct,e.image),I(this,ft,e.mask||null),I(this,$,e.speed||null),I(this,Y,e.states||{}),g(this,Y).origin=[{x:0,y:0,w:g(this,it).width,h:g(this,it).height}],I(this,U,document.createElement("canvas")),I(this,pt,g(this,U).getContext("2d")),I(this,st,this.getDefaultState()),I(this,Q,1)}static async load(t){try{const i=await(await fetch(t)).json();await Promise.all(Object.entries(i).map(async([n,a])=>{const w={image:await Bt(a.base),speed:a.speed||null,states:a.states||null};a.mask&&(w.mask=await Bt(a.mask)),new rt(n,w)}))}catch(e){console.error("Error loading sprites:",e)}}static get(t){return g(rt,vt)[t]??null}clone(){return new rt(null,{image:g(this,ct),mask:g(this,ft),speed:g(this,$),states:g(this,Y)})}async play(t=null){return new Promise(e=>{t=t||this.getDefaultState(),this.stop(),this.rewind(),I(this,st,t);const i=g(this,Y)[t].length;i>1&&g(this,$)&&I(this,nt,setInterval(()=>{++xt(this,Q)._>i&&(this.stop(),e())},g(this,$)))})}stop(){clearInterval(g(this,nt)),I(this,nt,null)}rewind(){I(this,Q,1)}loop(t=null){if(t=t||this.getDefaultState(),g(this,nt)&&g(this,st)===t)return;this.stop(),this.rewind(),I(this,st,t);const e=g(this,Y)[t].length;e>1&&g(this,$)&&I(this,nt,setInterval(()=>{++xt(this,Q)._>e&&I(this,Q,1)},g(this,$)))}async dye(t){I(this,it,await _t(g(this,ct),g(this,ft),t)),I(this,dt,null)}getDefaultState(){return Object.keys(g(this,Y))[0]}getFrame(){const t=g(this,Y)[g(this,st)][g(this,Q)-1];return g(this,dt)===t?g(this,U):(I(this,dt,t),g(this,U).width=t.w,g(this,U).height=t.h,g(this,pt).clearRect(0,0,g(this,U).width,g(this,U).height),g(this,pt).drawImage(g(this,it),t.x,t.y,t.w,t.h,0,0,t.w,t.h),g(this,U))}};vt=new WeakMap,kt=new WeakMap,it=new WeakMap,ct=new WeakMap,ft=new WeakMap,$=new WeakMap,Y=new WeakMap,U=new WeakMap,pt=new WeakMap,nt=new WeakMap,st=new WeakMap,Q=new WeakMap,dt=new WeakMap,R(rt,vt,{});let X=rt;var gt;const ht=class ht{constructor(t,e){S(this,"id",null);S(this,"name",null);S(this,"sprite",null);S(this,"type",null);S(this,"isBlockingCreatures",null);S(this,"isMovable",null);g(ht,gt)[t]=this,this.id=e.id,this.name=e.name,this.sprite=X.get(e.sprite),this.sprite.loop(),this.type=e.type,this.isBlockingCreatures=e.isBlockingCreatures,this.isMovable=e.isMovable}static async load(t){try{const i=await(await fetch(t)).json();return new Promise(n=>{Object.values(i).forEach(a=>{new ht(a.id,a)}),n()})}catch(e){console.error("Error loading items:",e)}}static get(t){return g(ht,gt)[t]??null}};gt=new WeakMap,R(ht,gt,{});let z=ht;const St=function(r,t,e=1){const i=r.x-e,n=r.y-e,a=r.x+e,y=r.y+e;return t.x>=i&&t.x<=a&&t.y>=n&&t.y<=y},Z=function(r,t){return r.x===t.x&&r.y===t.y};var Nt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},te=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},ee=function(r,t,e,i,n){this.parent=r,this.x=t,this.y=e,this.costSoFar=i,this.simpleDistanceToTarget=n,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},Ht={exports:{}};(function(r,t){(function(){var e,i,n,a,y,w,A,O,C,H,W,E,J,G,j;n=Math.floor,H=Math.min,i=function(l,c){return l<c?-1:l>c?1:0},C=function(l,c,f,m,h){var o;if(f==null&&(f=0),h==null&&(h=i),f<0)throw new Error("lo must be non-negative");for(m==null&&(m=l.length);f<m;)o=n((f+m)/2),h(c,l[o])<0?m=o:f=o+1;return[].splice.apply(l,[f,f-f].concat(c)),c},w=function(l,c,f){return f==null&&(f=i),l.push(c),G(l,0,l.length-1,f)},y=function(l,c){var f,m;return c==null&&(c=i),f=l.pop(),l.length?(m=l[0],l[0]=f,j(l,0,c)):m=f,m},O=function(l,c,f){var m;return f==null&&(f=i),m=l[0],l[0]=c,j(l,0,f),m},A=function(l,c,f){var m;return f==null&&(f=i),l.length&&f(l[0],c)<0&&(m=[l[0],c],c=m[0],l[0]=m[1],j(l,0,f)),c},a=function(l,c){var f,m,h,o,s,b;for(c==null&&(c=i),o=(function(){b=[];for(var P=0,T=n(l.length/2);0<=T?P<T:P>T;0<=T?P++:P--)b.push(P);return b}).apply(this).reverse(),s=[],m=0,h=o.length;m<h;m++)f=o[m],s.push(j(l,f,c));return s},J=function(l,c,f){var m;if(f==null&&(f=i),m=l.indexOf(c),m!==-1)return G(l,0,m,f),j(l,m,f)},W=function(l,c,f){var m,h,o,s,b;if(f==null&&(f=i),h=l.slice(0,c),!h.length)return h;for(a(h,f),b=l.slice(c),o=0,s=b.length;o<s;o++)m=b[o],A(h,m,f);return h.sort(f).reverse()},E=function(l,c,f){var m,h,o,s,b,P,T,D,F;if(f==null&&(f=i),c*10<=l.length){if(o=l.slice(0,c).sort(f),!o.length)return o;for(h=o[o.length-1],T=l.slice(c),s=0,P=T.length;s<P;s++)m=T[s],f(m,h)<0&&(C(o,m,0,null,f),o.pop(),h=o[o.length-1]);return o}for(a(l,f),F=[],b=0,D=H(c,l.length);0<=D?b<D:b>D;0<=D?++b:--b)F.push(y(l,f));return F},G=function(l,c,f,m){var h,o,s;for(m==null&&(m=i),h=l[f];f>c;){if(s=f-1>>1,o=l[s],m(h,o)<0){l[f]=o,f=s;continue}break}return l[f]=h},j=function(l,c,f){var m,h,o,s,b;for(f==null&&(f=i),h=l.length,b=c,o=l[c],m=2*c+1;m<h;)s=m+1,s<h&&!(f(l[m],l[s])<0)&&(m=s),l[c]=l[m],c=m,m=2*c+1;return l[c]=o,G(l,b,c,f)},e=function(){l.push=w,l.pop=y,l.replace=O,l.pushpop=A,l.heapify=a,l.updateItem=J,l.nlargest=W,l.nsmallest=E;function l(c){this.cmp=c??i,this.nodes=[]}return l.prototype.push=function(c){return w(this.nodes,c,this.cmp)},l.prototype.pop=function(){return y(this.nodes,this.cmp)},l.prototype.peek=function(){return this.nodes[0]},l.prototype.contains=function(c){return this.nodes.indexOf(c)!==-1},l.prototype.replace=function(c){return O(this.nodes,c,this.cmp)},l.prototype.pushpop=function(c){return A(this.nodes,c,this.cmp)},l.prototype.heapify=function(){return a(this.nodes,this.cmp)},l.prototype.updateItem=function(c){return J(this.nodes,c,this.cmp)},l.prototype.clear=function(){return this.nodes=[]},l.prototype.empty=function(){return this.nodes.length===0},l.prototype.size=function(){return this.nodes.length},l.prototype.clone=function(){var c;return c=new l,c.nodes=this.nodes.slice(0),c},l.prototype.toArray=function(){return this.nodes.slice(0)},l.prototype.insert=l.prototype.push,l.prototype.top=l.prototype.peek,l.prototype.front=l.prototype.peek,l.prototype.has=l.prototype.contains,l.prototype.copy=l.prototype.clone,l}(),function(l,c){return r.exports=c()}(this,function(){return e})}).call(Nt)})(Ht);var ie=Ht.exports,ne=ie,M={},se=te,oe=ee,re=ne;const ae=0,le=1;var ue=M,he=1;M.js=function(){var r=1,t=1.4,e=!1,i={},n,a={},y={},w={},A=!0,O,C={},H=[],W=Number.MAX_VALUE,E,J=!1;this.setAcceptableTiles=function(h){h instanceof Array?E=h:!isNaN(parseFloat(h))&&isFinite(h)&&(E=[h])},this.enableSync=function(){e=!0},this.disableSync=function(){e=!1},this.enableDiagonals=function(){J=!0},this.disableDiagonals=function(){J=!1},this.setGrid=function(h){n=h;for(var o=0;o<n.length;o++)for(var s=0;s<n[0].length;s++)a[n[o][s]]||(a[n[o][s]]=1)},this.setTileCost=function(h,o){a[h]=o},this.setAdditionalPointCost=function(h,o,s){y[o]===void 0&&(y[o]={}),y[o][h]=s},this.removeAdditionalPointCost=function(h,o){y[o]!==void 0&&delete y[o][h]},this.removeAllAdditionalPointCosts=function(){y={}},this.setDirectionalCondition=function(h,o,s){w[o]===void 0&&(w[o]={}),w[o][h]=s},this.removeAllDirectionalConditions=function(){w={}},this.setIterationsPerCalculation=function(h){W=h},this.avoidAdditionalPoint=function(h,o){i[o]===void 0&&(i[o]={}),i[o][h]=1},this.stopAvoidingAdditionalPoint=function(h,o){i[o]!==void 0&&delete i[o][h]},this.enableCornerCutting=function(){A=!0},this.disableCornerCutting=function(){A=!1},this.stopAvoidingAllAdditionalPoints=function(){i={}},this.findPath=function(h,o,s,b,P){var T=function(Ct){e?P(Ct):setTimeout(function(){P(Ct)})};if(E===void 0)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(n===void 0)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(h<0||o<0||s<0||b<0||h>n[0].length-1||o>n.length-1||s>n[0].length-1||b>n.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(h===s&&o===b){T([]);return}for(var D=n[b][s],F=!1,ot=0;ot<E.length;ot++)if(D===E[ot]){F=!0;break}if(F===!1){T(null);return}var B=new se;B.openList=new re(function(Ct,zt){return Ct.bestGuessDistance()-zt.bestGuessDistance()}),B.isDoneCalculating=!1,B.nodeHash={},B.startX=h,B.startY=o,B.endX=s,B.endY=b,B.callback=T,B.openList.push(f(B,B.startX,B.startY,null,r));var At=he++;return C[At]=B,H.push(At),At},this.cancelPath=function(h){return h in C?(delete C[h],!0):!1},this.calculate=function(){if(!(H.length===0||n===void 0||E===void 0))for(O=0;O<W;O++){if(H.length===0)return;e&&(O=0);var h=H[0],o=C[h];if(typeof o>"u"){H.shift();continue}if(o.openList.size()===0){o.callback(null),delete C[h],H.shift();continue}var s=o.openList.pop();if(o.endX===s.x&&o.endY===s.y){var b=[];b.push({x:s.x,y:s.y});for(var P=s.parent;P!=null;)b.push({x:P.x,y:P.y}),P=P.parent;b.reverse();var T=b;o.callback(T),delete C[h],H.shift();continue}s.list=ae,s.y>0&&G(o,s,0,-1,r*c(s.x,s.y-1)),s.x<n[0].length-1&&G(o,s,1,0,r*c(s.x+1,s.y)),s.y<n.length-1&&G(o,s,0,1,r*c(s.x,s.y+1)),s.x>0&&G(o,s,-1,0,r*c(s.x-1,s.y)),J&&(s.x>0&&s.y>0&&(A||j(n,E,s.x,s.y-1,s)&&j(n,E,s.x-1,s.y,s))&&G(o,s,-1,-1,t*c(s.x-1,s.y-1)),s.x<n[0].length-1&&s.y<n.length-1&&(A||j(n,E,s.x,s.y+1,s)&&j(n,E,s.x+1,s.y,s))&&G(o,s,1,1,t*c(s.x+1,s.y+1)),s.x<n[0].length-1&&s.y>0&&(A||j(n,E,s.x,s.y-1,s)&&j(n,E,s.x+1,s.y,s))&&G(o,s,1,-1,t*c(s.x+1,s.y-1)),s.x>0&&s.y<n.length-1&&(A||j(n,E,s.x,s.y+1,s)&&j(n,E,s.x-1,s.y,s))&&G(o,s,-1,1,t*c(s.x-1,s.y+1)))}};var G=function(h,o,s,b,P){var T=o.x+s,D=o.y+b;if((i[D]===void 0||i[D][T]===void 0)&&j(n,E,T,D,o)){var F=f(h,T,D,o,P);F.list===void 0?(F.list=le,h.openList.push(F)):o.costSoFar+P<F.costSoFar&&(F.costSoFar=o.costSoFar+P,F.parent=o,h.openList.updateItem(F))}},j=function(h,o,s,b,P){var T=w[b]&&w[b][s];if(T){var D=l(P.x-s,P.y-b),F=function(){for(var B=0;B<T.length;B++)if(T[B]===D)return!0;return!1};if(!F())return!1}for(var ot=0;ot<o.length;ot++)if(h[b][s]===o[ot])return!0;return!1},l=function(h,o){if(h===0&&o===-1)return M.TOP;if(h===1&&o===-1)return M.TOP_RIGHT;if(h===1&&o===0)return M.RIGHT;if(h===1&&o===1)return M.BOTTOM_RIGHT;if(h===0&&o===1)return M.BOTTOM;if(h===-1&&o===1)return M.BOTTOM_LEFT;if(h===-1&&o===0)return M.LEFT;if(h===-1&&o===-1)return M.TOP_LEFT;throw new Error("These differences are not valid: "+h+", "+o)},c=function(h,o){return y[o]&&y[o][h]||a[n[o][h]]},f=function(h,o,s,b,P){if(h.nodeHash[s]!==void 0){if(h.nodeHash[s][o]!==void 0)return h.nodeHash[s][o]}else h.nodeHash[s]={};var T=m(o,s,h.endX,h.endY);if(b!==null)var D=b.costSoFar+P;else D=0;var F=new oe(b,o,s,D,T);return h.nodeHash[s][o]=F,F},m=function(h,o,s,b){if(J){var P=Math.abs(h-s),T=Math.abs(o-b);return P<T?t*P+T:t*T+P}else{var P=Math.abs(h-s),T=Math.abs(o-b);return P+T}}};M.TOP="TOP";M.TOP_RIGHT="TOP_RIGHT";M.RIGHT="RIGHT";M.BOTTOM_RIGHT="BOTTOM_RIGHT";M.BOTTOM="BOTTOM";M.BOTTOM_LEFT="BOTTOM_LEFT";M.LEFT="LEFT";M.TOP_LEFT="TOP_LEFT";var ce=Object.defineProperty,fe=(r,t,e)=>t in r?ce(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,x=(r,t,e)=>(fe(r,typeof t!="symbol"?t+"":t,e),e);class jt{constructor(t){x(this,"_onPressed"),x(this,"_onPressedWithRepeat"),x(this,"_onReleased"),x(this,"_isPressed"),x(this,"_identity"),this._isPressed=!1,this._identity=t,typeof t=="function"?this._onPressedWithRepeat=t:(this._onPressed=t.onPressed,this._onPressedWithRepeat=t.onPressedWithRepeat,this._onReleased=t.onReleased)}get isEmpty(){return!this._onPressed&&!this._onPressedWithRepeat&&!this._onReleased}isOwnHandler(t){return this._identity===t}executePressed(t){var e,i;this._isPressed||(e=this._onPressed)==null||e.call(this,t),this._isPressed=!0,(i=this._onPressedWithRepeat)==null||i.call(this,t)}executeReleased(t){var e;this._isPressed&&((e=this._onReleased)==null||e.call(this,t)),this._isPressed=!1}}const It=class V{constructor(t,e,i={}){x(this,"_normalizedKeyCombo"),x(this,"_parsedKeyCombo"),x(this,"_handlerState"),x(this,"_keyComboEventMapper"),x(this,"_movingToNextSequenceAt"),x(this,"_sequenceIndex"),x(this,"_unitIndex"),x(this,"_lastActiveKeyPresses"),x(this,"_lastActiveKeyCount"),x(this,"_isPressedWithFinalUnit"),this._normalizedKeyCombo=V.normalizeKeyCombo(t),this._parsedKeyCombo=V.parseKeyCombo(t),this._handlerState=new jt(i),this._keyComboEventMapper=e,this._movingToNextSequenceAt=0,this._sequenceIndex=0,this._unitIndex=0,this._lastActiveKeyPresses=[],this._lastActiveKeyCount=0,this._isPressedWithFinalUnit=null}static parseKeyCombo(t){if(V._parseCache[t])return V._parseCache[t];const e=t.toLowerCase();let i="",n=[],a=[n],y=[a];const w=[y];let A=!1;for(let C=0;C<t.length;C+=1)if(e[C]==="\\")A=!0;else if((e[C]==="+"||e[C]===">"||e[C]===",")&&!A){if(i)throw new Error("cannot have two operators in a row");i=e[C]}else e[C].match(/[^\s]/)&&(i&&(i===","?(n=[],a=[n],y=[a],w.push(y)):i===">"?(n=[],a=[n],y.push(a)):i==="+"&&(n=[],a.push(n)),i=""),A=!1,n.push(e[C]));const O=w.map(C=>C.map(H=>H.map(W=>W.join(""))));return V._parseCache[t]=O,O}static stringifyKeyCombo(t){return t.map(e=>e.map(i=>i.map(n=>n==="+"?"\\+":n===">"?"\\>":n===","?"\\,":n).join("+")).join(">")).join(",")}static normalizeKeyCombo(t){if(V._normalizationCache[t])return V._normalizationCache[t];const e=this.stringifyKeyCombo(this.parseKeyCombo(t));return V._normalizationCache[t]=e,e}get isPressed(){return!!this._isPressedWithFinalUnit}get sequenceIndex(){return this.isPressed?this._parsedKeyCombo.length:this._sequenceIndex}isOwnHandler(t){return this._handlerState.isOwnHandler(t)}executePressed(t){var e;(e=this._isPressedWithFinalUnit)!=null&&e.has(t.key)&&this._handlerState.executePressed(this._wrapEvent(this._lastActiveKeyPresses,{key:t.key,event:t}))}executeReleased(t){var e;(e=this._isPressedWithFinalUnit)!=null&&e.has(t.key)&&(this._handlerState.executeReleased(this._wrapEvent(this._lastActiveKeyPresses,{key:t.key,event:t})),this._isPressedWithFinalUnit=null)}updateState(t,e){const i=t.length,n=i<this._lastActiveKeyCount;this._lastActiveKeyCount=i;const a=this._parsedKeyCombo[this._sequenceIndex],y=a.slice(0,this._unitIndex),w=a.slice(this._unitIndex),A=()=>{this._movingToNextSequenceAt=0,this._sequenceIndex=0,this._unitIndex=0,this._lastActiveKeyPresses.length=0,this._handlerState.isEmpty&&(this._isPressedWithFinalUnit=null)};let O=0;if(n){if(this._movingToNextSequenceAt===0)return A();if(this._movingToNextSequenceAt+e<Date.now()||i!==0)return;this._movingToNextSequenceAt=0,this._sequenceIndex+=1,this._unitIndex=0;return}for(const C of y){for(const H of C){let W=!1;for(let E=O;E<t.length&&E<O+C.length;E+=1)if(t[E].key===H){W=!0;break}if(!W)return A()}O+=C.length}if(this._movingToNextSequenceAt===0){for(const C of w){for(const H of C){let W=!1;for(let E=O;E<t.length&&E<O+C.length;E+=1)if(t[E].key===H){W=!0;break}if(!W)return}this._unitIndex+=1,O+=C.length}if(O<i-1)return A();if(this._lastActiveKeyPresses[this._sequenceIndex]=t.slice(0),this._sequenceIndex<this._parsedKeyCombo.length-1){this._movingToNextSequenceAt=Date.now();return}this._isPressedWithFinalUnit=new Set(a[a.length-1])}}_wrapEvent(t,e){return{...this._keyComboEventMapper(t,e),keyCombo:this._normalizedKeyCombo,keyEvents:t.flat().map(i=>i.event),finalKeyEvent:e.event}}};x(It,"_parseCache",{}),x(It,"_normalizationCache",{});let et=It;const pe={addEventListener:(...r)=>{},removeEventListener:(...r)=>{},dispatchEvent:(...r)=>{}},de={userAgent:""},mt=()=>typeof document<"u"?document:pe,ye=()=>typeof navigator<"u"?navigator:de,me=()=>ye().userAgent.toLocaleLowerCase().includes("mac");let Ot=!1;const ve=r=>{!me()||r.key!=="Meta"||(Ot=!0)},ge=r=>{!Ot||r.key!=="Meta"||(Ot=!1,qt())},Tt=new Map,be=r=>{Tt.set(r.key,r)},we=r=>{Tt.delete(r.key)},qt=()=>{for(const r of Tt.values()){const t=new KeyboardEvent("keyup",{key:r.key,code:r.code,bubbles:!0,cancelable:!0});mt().dispatchEvent(t)}Tt.clear()},Ce=r=>{try{const t=()=>r();return addEventListener("focus",t),()=>{removeEventListener("focus",t)}}catch{}},xe=r=>{try{const t=()=>{qt(),r()};return addEventListener("blur",t),()=>removeEventListener("blur",t)}catch{}},Pe=r=>{try{const t=e=>(be(e),ve(e),r({key:e.key,originalEvent:e,composedPath:()=>e.composedPath(),preventDefault:()=>e.preventDefault()}));return mt().addEventListener("keydown",t),()=>mt().removeEventListener("keydown",t)}catch{}},Se=r=>{try{const t=e=>(we(e),ge(e),r({key:e.key,originalEvent:e,composedPath:()=>e.composedPath(),preventDefault:()=>e.preventDefault()}));return mt().addEventListener("keyup",t),()=>mt().removeEventListener("keyup",t)}catch{}},Te=1e3;class ke{constructor(t={}){x(this,"sequenceTimeout"),x(this,"_isActive"),x(this,"_unbinder"),x(this,"_onActiveBinder"),x(this,"_onInactiveBinder"),x(this,"_onKeyPressedBinder"),x(this,"_onKeyReleasedBinder"),x(this,"_keyComboEventMapper"),x(this,"_selfReleasingKeys"),x(this,"_keyRemap"),x(this,"_handlerStates"),x(this,"_keyComboStates"),x(this,"_keyComboStatesArray"),x(this,"_activeKeyPresses"),x(this,"_activeKeyMap"),x(this,"_watchedKeyComboStates"),this.sequenceTimeout=Te,this._isActive=!0,this._onActiveBinder=()=>{},this._onInactiveBinder=()=>{},this._onKeyPressedBinder=()=>{},this._onKeyReleasedBinder=()=>{},this._keyComboEventMapper=()=>({}),this._selfReleasingKeys=[],this._keyRemap={},this._handlerStates={},this._keyComboStates={},this._keyComboStatesArray=[],this._activeKeyPresses=[],this._activeKeyMap=new Map,this._watchedKeyComboStates={},this.bindEnvironment(t)}get pressedKeys(){return this._activeKeyPresses.map(t=>t.key)}bindKey(t,e){var i;t=t.toLowerCase();const n=new jt(e);(i=this._handlerStates)[t]??(i[t]=[]),this._handlerStates[t].push(n)}unbindKey(t,e){t=t.toLowerCase();const i=this._handlerStates[t];if(i)if(e)for(let n=0;n<i.length;n+=1)i[n].isOwnHandler(e)&&(i.splice(n,1),n-=1);else i.length=0}bindKeyCombo(t,e){var i;t=et.normalizeKeyCombo(t);const n=new et(t,this._keyComboEventMapper,e);(i=this._keyComboStates)[t]??(i[t]=[]),this._keyComboStates[t].push(n),this._keyComboStatesArray.push(n)}unbindKeyCombo(t,e){t=et.normalizeKeyCombo(t);const i=this._keyComboStates[t];if(i)if(e){for(let n=0;n<i.length;n+=1)if(i[n].isOwnHandler(e)){for(let a=0;a<this._keyComboStatesArray.length;a+=1)this._keyComboStatesArray[a]===i[n]&&(this._keyComboStatesArray.splice(a,1),a-=1);i.splice(n,1),n-=1}}else i.length=0}checkKey(t){return this._activeKeyMap.has(t.toLowerCase())}checkKeyCombo(t){return this._ensureCachedKeyComboState(t).isPressed}checkKeyComboSequenceIndex(t){return this._ensureCachedKeyComboState(t).sequenceIndex}bindEnvironment(t={}){this.unbindEnvironment(),this._onActiveBinder=t.onActive??Ce,this._onInactiveBinder=t.onInactive??xe,this._onKeyPressedBinder=t.onKeyPressed??Pe,this._onKeyReleasedBinder=t.onKeyReleased??Se,this._keyComboEventMapper=t.mapKeyComboEvent??(()=>({})),this._selfReleasingKeys=t.selfReleasingKeys??[],this._keyRemap=t.keyRemap??{};const e=this._onActiveBinder(()=>{this._isActive=!0}),i=this._onInactiveBinder(()=>{this._isActive=!1}),n=this._onKeyPressedBinder(y=>{this._handleKeyPress(y)}),a=this._onKeyReleasedBinder(y=>{this._handleKeyRelease(y)});this._unbinder=()=>{e==null||e(),i==null||i(),n==null||n(),a==null||a()}}unbindEnvironment(){var t;(t=this._unbinder)==null||t.call(this)}_ensureCachedKeyComboState(t){t=et.normalizeKeyCombo(t),this._watchedKeyComboStates[t]||(this._watchedKeyComboStates[t]=new et(t,this._keyComboEventMapper));const e=this._watchedKeyComboStates[t];return e.updateState(this._activeKeyPresses,this.sequenceTimeout),e}_handleKeyPress(t){if(!this._isActive)return;t={...t,key:t.key.toLowerCase()};const e=this._keyRemap[t.key];e&&(t.key=e);const i=this._handlerStates[t.key];if(i)for(const a of i)a.executePressed(t);const n=this._activeKeyMap.get(t.key);if(n)n.event=t;else{const a={key:t.key,event:t};this._activeKeyMap.set(t.key,a),this._activeKeyPresses.push(a)}this._updateKeyComboStates();for(const a of this._keyComboStatesArray)a.executePressed(t)}_handleKeyRelease(t){t={...t,key:t.key.toLowerCase()};const e=this._keyRemap[t.key];e&&(t.key=e);const i=this._handlerStates[t.key];if(i)for(const n of i)n.executeReleased(t);if(this._activeKeyMap.has(t.key)){this._activeKeyMap.delete(t.key);for(let n=0;n<this._activeKeyPresses.length;n+=1)if(this._activeKeyPresses[n].key===t.key){this._activeKeyPresses.splice(n,1),n-=1;break}}this._tryReleaseSelfReleasingKeys(),this._updateKeyComboStates();for(const n of this._keyComboStatesArray)n.executeReleased(t)}_updateKeyComboStates(){for(const t of this._keyComboStatesArray)t.updateState(this._activeKeyPresses,this.sequenceTimeout)}_tryReleaseSelfReleasingKeys(){for(const t of this._activeKeyPresses)for(const e of this._selfReleasingKeys)t.key===e&&this._handleKeyRelease(t.event)}}let Ee,Lt;const Ke=r=>{Lt=r??new ke(Ee)},Wt=()=>(Lt||Ke(),Lt),Ae=(...r)=>Wt().bindKey(...r),_=(...r)=>Wt().checkKey(...r);et.normalizeKeyCombo;et.stringifyKeyCombo;et.parseKeyCombo;const N=class N{static init(){document.addEventListener("keydown",()=>setTimeout(N.triggerKeyHoldingFunctions)),window.keyboardLoop=setInterval(N.triggerKeyHoldingFunctions,200),Ae("shift",{onPressed:()=>{N.shift.isPressed=!0,q.onPositionChange()},onReleased:()=>{N.shift.isPressed=!1,q.onPositionChange()}})}};S(N,"shift",{isPressed:!1}),S(N,"triggerKeyHoldingFunctions",()=>{(_("ArrowUp")||_("w"))&&window.dispatchEvent(new CustomEvent("move-north")),(_("ArrowDown")||_("s"))&&window.dispatchEvent(new CustomEvent("move-south")),(_("ArrowLeft")||_("a"))&&window.dispatchEvent(new CustomEvent("move-west")),(_("ArrowRight")||_("d"))&&window.dispatchEvent(new CustomEvent("move-east"))});let lt=N;var K=null;const Ie=function(r){K=r},u=class u{static init(){document.addEventListener("mousemove",t=>{u.recalcMousePosition(t),u.grabbing.initialised&&!u.grabbing.itemId&&u.onGrabStart()},!1),document.addEventListener("mousedown",t=>{u.recalcMousePosition(t),(t.which===1||t.button===0)&&(u.buttons.left.isPressed=!0,u.onLeftButtonPress()),(t.which===3||t.button===2)&&(u.buttons.right.isPressed=!0,u.onRightButtonPress())},!1),document.addEventListener("mouseup",t=>{u.recalcMousePosition(t),(t.which===1||t.button===0)&&(u.buttons.left.isPressed=!1,u.onLeftButtonRelease()),(t.which===3||t.button===2)&&(u.buttons.right.isPressed=!1,u.onRightButtonRelease())},!1),document.addEventListener("contextmenu",t=>(t==null?void 0:t.cancelable)&&t.preventDefault())}static recalcMousePosition(t){const e=d.ctx.canvas.getBoundingClientRect(),i={positionWindow:{...u.positionWindow},positionClient:{...u.positionClient},positionServer:{...u.positionServer}};u.positionWindow={x:t.clientX,y:t.clientY},u.positionCanvas={x:(t.clientX-e.left)/(e.right-e.left)*d.ctx.canvas.width,y:(t.clientY-e.top)/(e.bottom-e.top)*d.ctx.canvas.height},u.positionClient={x:Math.floor((u.positionCanvas.x+K.offset.x)/k),y:Math.floor((u.positionCanvas.y+K.offset.y)/k)},u.positionServer=d.positionClientToServer(u.positionClient),Z(u.positionClient,i.positionClient)||u.onPositionChange(),Z(u.positionServer,i.positionServer)||u.onPositionChange()}static onPositionChange(){if(u.grabbing.itemId)return;if(lt.shift.isPressed){d.ctx.canvas.setAttribute("cursor","eye");return}u.positionServer=d.positionClientToServer(u.positionClient);const t=d.getTileTopItem(u.positionServer);if(!t){d.ctx.canvas.removeAttribute("cursor");return}t===6?d.ctx.canvas.setAttribute("cursor","chest"):t===8?d.ctx.canvas.setAttribute("cursor","pick"):d.ctx.canvas.removeAttribute("cursor")}static onLeftButtonPress(){if(lt.shift.isPressed)return;const t=d.getTileTopItem(u.positionServer);t&&z.get(t).isMovable&&(u.grabbing.itemId=null,u.grabbing.position={x:null,y:null},u.grabbing.initialised=!0)}static onLeftButtonRelease(){if(u.grabbing.initialised&&u.grabbing.itemId)u.onGrabEnd();else{const t=X.get("pointer-cross-yellow").clone(),e={sprite:t,position:{...u.positionCanvas}};t.play().then(()=>{u.pointerEffect===e&&(u.pointerEffect=null)}),u.pointerEffect=e,u.grabbing.initialised=!1,u.grabbing.itemId=null,u.grabbing.position={x:null,y:null},yt.setPath(u.positionServer,"walk")}}static onRightButtonPress(){const t={...u.positionServer},e=d.getTileTopItem(t);if(e&&St(K.position,t)&&z.get(e).type==="object"){const i=X.get("pointer-cross-red").clone(),n={sprite:i,position:{...u.positionCanvas}};i.play().then(()=>{u.pointerEffect===n&&(u.pointerEffect=null)}),u.pointerEffect=n,u.use(u.positionServer,e)}}static onRightButtonRelease(){const t=z.get(d.getTileTopItem(u.positionServer));if(t.type==="object"&&!St(K.position,u.positionServer)){const e=X.get("pointer-cross-red").clone(),i={sprite:e,position:{...u.positionCanvas}};e.play().then(()=>{u.pointerEffect===i&&(u.pointerEffect=null)}),u.pointerEffect=i,yt.setPath(u.positionServer,"use",{itemId:t.id})}}static onGrabStart(){u.grabbing.itemId=d.getTileTopItem(u.positionServer),u.grabbing.position={...u.positionServer},d.ctx.canvas.setAttribute("cursor","crosshair")}static onGrabEnd(){u.handleThrow(),u.grabbing.initialised=!1,u.grabbing.itemId=null,u.grabbing.position={x:null,y:null},u.onPositionChange()}static handleThrow(){if(St(K.position,u.grabbing.position)===!1||Z(u.grabbing.position,u.positionServer))return;const t=d.getTileTopItem(u.grabbing.position);t===u.grabbing.itemId&&(d.getTileStack(u.positionServer).find(e=>z.get(e).isBlockingCreatures)||(d.tiles[u.grabbing.position.y][u.grabbing.position.x].pop(),d.tiles[u.positionServer.y][u.positionServer.x].push(t)))}static use(t,e){d.getTileTopItem(t)===e&&St(K.position,t)&&(e===6&&(at.get("ore-hit").run(t),d.tiles[t.y][t.x].pop(),d.tiles[t.y][t.x].push(9),u.onPositionChange()),e===8&&(at.get("ore-hit").run(t),d.tiles[t.y][t.x].push(10)),e===9&&at.get("yellow-sparkles").run(K.position))}};S(u,"positionWindow",{x:null,y:null}),S(u,"positionCanvas",{x:null,y:null}),S(u,"positionClient",{x:null,y:null}),S(u,"positionServer",{x:null,y:null}),S(u,"buttons",{left:{isPressed:!1},right:{isPressed:!1}}),S(u,"grabbing",{initialised:!1,itemId:null,position:{x:null,y:null}}),S(u,"pointerEffect",null);let q=u;const v=class v{static init(){v.easyStar=new ue.js,window.addEventListener("move-north",()=>{v.clearPath(),v.walk("north")}),window.addEventListener("move-south",()=>{v.clearPath(),v.walk("south")}),window.addEventListener("move-west",()=>{v.clearPath(),v.walk("west")}),window.addEventListener("move-east",()=>{v.clearPath(),v.walk("east")})}static walk(t){if(K.movement.isMoving)return K.movement.currentFrame>k-k/3?(v.queuedMove=t,!0):!1;const e=v.getTargetPosition(K,t);return d.isWalkable(e)?(v.move(K,e,t),!0):(K.sprite.loop("idle-"+t),!1)}static move(t,e,i){t.movement.timeouts.forEach(n=>clearTimeout(n)),t.movement.timeouts=[],t.currentFrame=0,t.offset={x:0,y:0},t.movement.isMoving=!0;for(let n=0;n<k;n++){const a=setTimeout(()=>v.handleMovingFrame(t,e,i),1e3/t.speed/k*n);t.movement.timeouts.push(a)}}static handleMovingFrame(t,e,i){if(t.sprite.loop("walk-"+i),t.movement.currentFrame++,v.updateOffsetAfterAnimationFrameChange(t,i),t.movement.currentFrame===k/2&&(t.position=e,window.dispatchEvent(new CustomEvent("hero-position-changed")),v.updateOffsetAfterPositionChange(t,i)),t.movement.currentFrame===k){if(t.movement.isMoving=!1,t.movement.currentFrame=0,t.movement.timeouts.forEach(n=>clearTimeout(n)),t.movement.timeouts=[],t.isHero()&&v.queuedMove&&(i=v.queuedMove,v.queuedMove=null,v.walk(i)))return;if(v.path)if(Z(v.path.destination,e))v.clearPath();else{v.makePathStep();return}t.sprite.loop("idle-"+i)}}static getDirection(t,e){if(t.x<e.x)return"east";if(t.x>e.x)return"west";if(t.y>e.y)return"north";if(t.y<e.y)return"south"}static getTargetPosition(t,e){const i={north:{x:0,y:-1},south:{x:0,y:1},west:{x:-1,y:0},east:{x:1,y:0}};return{x:t.position.x+i[e].x,y:t.position.y+i[e].y}}static updateOffsetAfterAnimationFrameChange(t,e){({north:()=>t.offset.y--,south:()=>t.offset.y++,west:()=>t.offset.x--,east:()=>t.offset.x++})[e]()}static updateOffsetAfterPositionChange(t,e){({north:()=>t.offset.y=k/2,south:()=>t.offset.y=-(k/2),west:()=>t.offset.x=k/2,east:()=>t.offset.x=-(k/2)})[e]()}static clearPath(){v.path=null}static setPath(t,e,i=null){v.path={destination:{...t},action:e,actionData:i},K.movement.isMoving||v.makePathStep()}static makePathStep(){if(!v.path||Z(v.path.destination,K.position)){v.path=null,K.sprite.loop("idle-south");return}const t=[],e=d.positionServerToClient(K.position),i=d.positionServerToClient(v.path.destination);for(let n=d.area.fromY;n<=d.area.toY;n++){const a=[];for(let y=d.area.fromX;y<=d.area.toX;y++){const w={x:y,y:n};let A=Z(v.path.destination,w)?!0:d.isWalkable(w);a.push(Number(A))}t.push(a)}v.easyStar.setGrid(t),v.easyStar.setAcceptableTiles([1]),v.easyStar.findPath(e.x,e.y,i.x,i.y,n=>{if(n===null){console.log("Path was not found.");return}if(v.path.action==="use"&&n.length===2){K.sprite.loop("idle-south"),q.use(v.path.destination,v.path.actionData.itemId),v.clearPath();return}v.walk(v.getDirection(e,n[1]))||v.clearPath()}),v.easyStar.calculate()}};S(v,"queuedMove",null),S(v,"easyStar",null),S(v,"path",null);let yt=v;class Gt{constructor(t,e,i){S(this,"position",{x:null,y:null});S(this,"offset",{x:null,y:null});S(this,"sprite",null);S(this,"speed",2);S(this,"movement",{isMoving:!1,currentFrame:0,timeouts:[]});d.creatures[t]=this,this.position=e,this.offset=i,this.sprite=X.get("outfit").clone(),this.sprite.dye([Pt(),Pt(),Pt(),Pt()]),this.sprite.loop("idle-south")}isHero(){return this===K}move(t,e){yt.move(this,e,t)}}const p=class p{static init(){const t=document.createElement("canvas");t.id="board",t.width=k*Rt,t.height=k*Mt,document.querySelector("#app").append(t),p.ctx=t.getContext("2d"),p.width=Rt,p.height=Mt,p.update(),window.addEventListener("hero-position-changed",()=>{p.update()})}static update(){p.area.fromX=K.position.x-Math.floor(p.width/2),p.area.toX=K.position.x+Math.floor(p.width/2),p.area.fromY=K.position.y-Math.floor(p.height/2),p.area.toY=K.position.y+Math.floor(p.height/2);for(const[i,n]of Object.entries(p.creatures))p.isOnArea(n.position)||delete p.creatures[i];const t=[],e={};for(let i=p.area.fromY;i<=p.area.toY;i++)for(let n=p.area.fromX;n<=p.area.toX;n++)e[i]=e[i]||{},p.tiles[i]&&p.tiles[i][n]?e[i][n]=p.tiles[i][n]:(e[i][n]=[],t.push({x:n,y:i}));p.tiles=e,p.requestTiles(t)}static getTileStack(t){return typeof p.tiles[t.y]>"u"||typeof p.tiles[t.y][t.x]>"u"?[]:p.tiles[t.y][t.x]}static getTileTopItem(t){const e=p.getTileStack(t);return e[e.length-1]??null}static updateTile(t,e){typeof p.tiles[t.y]<"u"&&typeof p.tiles[t.y][t.x]<"u"&&(p.tiles[t.y][t.x]=e)}static requestTiles(t){setTimeout(()=>{for(const e of t){const i=[];ut(40)?i.push(2):ut(40)?i.push(3):ut(30)?i.push(4):i.push(1),Z(e,K.position)||(ut(100)?i.push(6):ut(100)&&i.push(8)),p.updateTile(e,i),ut(350)&&new Gt(Zt(20),e,{x:0,y:0})}},100)}static isWalkable(t){const e=p.getTileStack(t);return!(!e.find(i=>z.get(i).type==="ground")||e.find(i=>z.get(i).isBlockingCreatures))}static isOnArea(t){return t.x>=p.area.fromX&&t.x<=p.area.toX&&t.y>=p.area.fromY&&t.y<=p.area.toY}static positionClientToServer(t){return{x:t.x+p.area.fromX,y:t.y+p.area.fromY}}static positionServerToClient(t){return{x:t.x-p.area.fromX,y:t.y-p.area.fromY}}static getVisibleEffectsSprites(t){return p.effects&&p.effects[t.y]&&p.effects[t.y][t.x]?Object.values(this.effects[t.y][t.x]):[]}};S(p,"ctx",null),S(p,"width",null),S(p,"height",null),S(p,"tiles",{}),S(p,"effects",{}),S(p,"creatures",{}),S(p,"area",{fromX:null,fromY:null,toX:null,toY:null});let d=p;var bt,Et,Kt,wt;const tt=class tt{constructor(t,e){R(this,Kt,null);R(this,wt,null);g(tt,bt)[t]=this,I(this,Kt,t),I(this,wt,e)}static async load(t){try{const i=await(await fetch(t)).json();return new Promise(n=>{Object.values(i).forEach(a=>{new tt(a.id,X.get(a.sprite))}),n()})}catch(e){console.error("Error loading effects:",e)}}static get(t){return g(tt,bt)[t]??null}run(t){d.effects[t.y]||(d.effects[t.y]={}),d.effects[t.y][t.x]||(d.effects[t.y][t.x]={});const e=++xt(tt,Et)._,i=g(this,wt).clone();d.effects[t.y][t.x][e]=i,i.play().then(()=>{delete d.effects[t.y][t.x][e]})}};bt=new WeakMap,Et=new WeakMap,Kt=new WeakMap,wt=new WeakMap,R(tt,bt,{}),R(tt,Et,0);let at=tt;class L{static renderTile(t,e,i,n){i==="ground"&&n.forEach(a=>{z.get(a).type==="ground"&&L.drawSprite(t,z.get(a).sprite)}),i==="objects"&&(n.forEach(a=>{const y=z.get(a);y.type==="object"&&L.drawSprite(t,y.sprite)}),lt.shift.isPressed&&Z(t,q.positionClient)&&L.drawSprite(t,X.get("cursor")),Object.values(d.creatures).forEach(a=>{Z(e,a.position)&&L.drawCreature(t,a)}),d.getVisibleEffectsSprites(e).forEach(a=>{L.drawSprite(t,a)}))}static drawSprite(t,e){const i=e.getFrame(),n=t.y*k+(k-i.height),a=t.x*k+(Math.ceil(k/2)-Math.ceil(i.width/2));L.tempCtx.drawImage(i,a,n)}static drawCreature(t,e){const i=e.sprite.getFrame(),n=t.y*k+(k-i.height)+e.offset.y,a=t.x*k+(Math.ceil(k/2)-Math.ceil(i.width/2))+e.offset.x;L.tempCtx.drawImage(i,a,n)}static cropEdges(t){t.clearRect(0,0,k,t.canvas.height),t.clearRect(0,0,t.canvas.width,k),t.clearRect(t.canvas.width-k,0,t.canvas.width,t.canvas.height),t.clearRect(0,t.canvas.height-k,t.canvas.width,t.canvas.height)}static render(){const t=document.createElement("canvas");t.width=d.ctx.canvas.width,t.height=d.ctx.canvas.height,L.tempCtx=t.getContext("2d"),L.tempCtx.fillStyle="#25131a",L.tempCtx.fillRect(0,0,L.tempCtx.canvas.width,L.tempCtx.canvas.height);for(let e of["ground","objects"]){let i=0;for(let[n,a]of Object.entries(d.tiles)){let y=0;for(let[w,A]of Object.entries(a)){const O={x:y,y:i},C={x:Number(w),y:Number(n)};L.renderTile(O,C,e,A),y++}i++}}L.renderInfoBox(L.tempCtx),L.renderPointerEffect(L.tempCtx),d.ctx.clearRect(0,0,d.ctx.canvas.width,d.ctx.canvas.height),d.ctx.drawImage(t,-K.offset.x,-K.offset.y),L.cropEdges(d.ctx),window.requestAnimationFrame(L.render)}static renderPointerEffect(t){if(!q.pointerEffect)return;const e=q.pointerEffect.sprite.getFrame(),i=q.pointerEffect.position,n=K.offset;t.drawImage(e,i.x+n.x-e.width/2,i.y+n.y-e.height/2)}static renderInfoBox(t){if(lt.shift.isPressed){const e={x:q.positionClient.x*k+k/3*2,y:q.positionClient.y*k+k/3*2};for(const[a,y]of Object.entries(d.creatures))if(q.positionServer.x===y.position.x&&q.positionServer.y===y.position.y){const w=a.length*5.5+8;t.fillStyle="#1c3d17",t.fillRect(e.x,e.y,w,16),t.strokeStyle="#FFA500",t.strokeRect(e.x,e.y,w,16),t.font="normal bold 9px monospace",t.strokeStyle="#000000",t.strokeText(a,e.x+4,e.y+11),t.strokeText(a,e.x+4,e.y+11),t.fillStyle="#FFA500",t.fillText(a,e.x+4,e.y+11);return}const i=d.getTileTopItem(q.positionServer),n=z.get(i);if(n&&n.type==="object"){const a=n.name.length*5.5+8;t.fillStyle="#172459",t.fillRect(e.x,e.y,a,16),t.strokeStyle="#FFA500",t.strokeRect(e.x,e.y,a,16),t.font="normal bold 9px monospace",t.strokeStyle="#000000",t.strokeText(n.name,e.x+4,e.y+11),t.strokeText(n.name,e.x+4,e.y+11),t.fillStyle="#FFA500",t.fillText(n.name,e.x+4,e.y+11)}}}}const Oe=async()=>{async function r(){await X.load(Xt),await z.load(Vt),await at.load($t)}async function t(){lt.init(),q.init(),Ie(new Gt("Nemnes",{x:100,y:100},{x:0,y:0})),yt.init(),d.init(),L.render(),at.get("energy").run(K.position)}await r(),await t()};Oe();
