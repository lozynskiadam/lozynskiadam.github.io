var zt=Object.defineProperty;var Vt=(r,t,e)=>t in r?zt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var w=(r,t,e)=>(Vt(r,typeof t!="symbol"?t+"":t,e),e),Ft=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var g=(r,t,e)=>(Ft(r,t,"read from private field"),e?e.call(r):t.get(r)),F=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},A=(r,t,e,i)=>(Ft(r,t,"write to private field"),i?i.call(r,e):t.set(r,e),e);var Ct=(r,t,e,i)=>({set _(s){A(r,t,s,e)},get _(){return g(r,t,i)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const v of l.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function e(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=e(s);fetch(s.href,l)}})();const K=32,Rt=33,Mt=19,$t="data/sprites.json",Qt="data/items.json",Zt="data/effects.json";const Jt=function(r){return Math.floor(Math.random()*(r+1))},_=function(r){return Jt(r)===r},Yt=function(r){return window.btoa(String.fromCharCode(...window.crypto.getRandomValues(new Uint8Array(r*2)))).replace(/[+/]/g,"").substring(0,r)},Tt=function(){return"#000000".replace(/0/g,function(){return(~~(Math.random()*16)).toString(16)})},Dt=function(r){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},Xt=function(r,t){Object.keys(t).forEach(s=>{t[Dt(s).toString()]=Dt(t[s]),delete t[s]});const e=document.createElement("canvas").getContext("2d");e.canvas.width=r.width,e.canvas.height=r.height,e.drawImage(r,0,0);const i=e.getImageData(0,0,e.canvas.width,e.canvas.height);for(let s=0;s<i.data.length;s+=4){const l=[i.data[s],i.data[s+1],i.data[s+2]].toString();if(l in t){const v=t[l];i.data[s]=v[0],i.data[s+1]=v[1],i.data[s+2]=v[2],i.data[s+3]=255}}return e.putImageData(i,0,0),e.canvas},Bt=async function(r){return new Promise(t=>{const e=new Image;e.onload=()=>t(e),e.src=r})},_t=async function(r,t,e){return new Promise(i=>{if(!t)return r;const s=["#ff0000","#ff00ff","#0000ff","#ffff00","#00ffff","#ff00ff"],l={};e.forEach((O,x)=>{l[s[x]]=O});const v=Xt(t,l),S=document.createElement("canvas").getContext("2d");S.canvas.width=r.width,S.canvas.height=r.height,S.drawImage(r,0,0),S.globalCompositeOperation="overlay",S.drawImage(v,0,0);const I=new Image;I.onload=()=>i(I),I.src=S.canvas.toDataURL("image/png")})};var gt,kt,st,ft,pt,Z,V,z,dt,nt,ot,J,yt;const at=class at{constructor(t,e){F(this,kt,null);F(this,st,null);F(this,ft,null);F(this,pt,null);F(this,Z,null);F(this,V,null);F(this,z,null);F(this,dt,null);F(this,nt,null);F(this,ot,null);F(this,J,null);F(this,yt,null);t&&(g(at,gt)[t]=this),A(this,kt,t),A(this,st,e.image),A(this,ft,e.image),A(this,pt,e.mask||null),A(this,Z,e.speed||null),A(this,V,e.states||{}),g(this,V).origin=[{x:0,y:0,w:g(this,st).width,h:g(this,st).height}],A(this,z,document.createElement("canvas")),A(this,dt,g(this,z).getContext("2d")),A(this,ot,this.getDefaultState()),A(this,J,1)}static async load(t){try{const i=await(await fetch(t)).json();await Promise.all(Object.entries(i).map(async([s,l])=>{const S={image:await Bt(l.base),speed:l.speed||null,states:l.states||null};l.mask&&(S.mask=await Bt(l.mask)),new at(s,S)}))}catch(e){console.error("Error loading sprites:",e)}}static get(t){return g(at,gt)[t]??null}clone(){return new at(null,{image:g(this,ft),mask:g(this,pt),speed:g(this,Z),states:g(this,V)})}async play(t=null){return new Promise(e=>{t=t||this.getDefaultState(),this.stop(),this.rewind(),A(this,ot,t);const i=g(this,V)[t].length;i>1&&g(this,Z)&&A(this,nt,setInterval(()=>{++Ct(this,J)._>i&&(this.stop(),e())},g(this,Z)))})}stop(){clearInterval(g(this,nt)),A(this,nt,null)}rewind(){A(this,J,1)}loop(t=null){if(t=t||this.getDefaultState(),g(this,nt)&&g(this,ot)===t)return;this.stop(),this.rewind(),A(this,ot,t);const e=g(this,V)[t].length;e>1&&g(this,Z)&&A(this,nt,setInterval(()=>{++Ct(this,J)._>e&&A(this,J,1)},g(this,Z)))}async dye(t){A(this,st,await _t(g(this,ft),g(this,pt),t)),A(this,yt,null)}getDefaultState(){return Object.keys(g(this,V))[0]}getFrame(){const t=g(this,V)[g(this,ot)][g(this,J)-1];return g(this,yt)===t?g(this,z):(A(this,yt,t),g(this,z).width=t.w,g(this,z).height=t.h,g(this,dt).clearRect(0,0,g(this,z).width,g(this,z).height),g(this,dt).drawImage(g(this,st),t.x,t.y,t.w,t.h,0,0,t.w,t.h),g(this,z))}};gt=new WeakMap,kt=new WeakMap,st=new WeakMap,ft=new WeakMap,pt=new WeakMap,Z=new WeakMap,V=new WeakMap,z=new WeakMap,dt=new WeakMap,nt=new WeakMap,ot=new WeakMap,J=new WeakMap,yt=new WeakMap,F(at,gt,{});let $=at;var bt;const ht=class ht{constructor(t,e){w(this,"id",null);w(this,"name",null);w(this,"type",null);w(this,"sprite",null);w(this,"isUsable",null);w(this,"isMovable",null);w(this,"isBlockingCreatures",null);w(this,"isBlockingItems",null);g(ht,bt)[t]=this,this.id=e.id,this.name=e.name,this.type=e.type,this.isUsable=e.isUsable,this.isMovable=e.isMovable,this.isBlockingCreatures=e.isBlockingCreatures,this.isBlockingItems=e.isBlockingItems,this.sprite=$.get(e.sprite),this.sprite.loop()}static async load(t){try{const i=await(await fetch(t)).json();return new Promise(s=>{Object.values(i).forEach(l=>new ht(l.id,l)),s()})}catch(e){console.error("Error loading items:",e)}}static get(t){return g(ht,bt)[t]??null}};bt=new WeakMap,F(ht,bt,{});let G=ht;const ct=function(r,t,e=1){const i=r.x-e,s=r.y-e,l=r.x+e,v=r.y+e;return t.x>=i&&t.x<=l&&t.y>=s&&t.y<=v},Y=function(r,t){return r.x===t.x&&r.y===t.y};var Nt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},te=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},ee=function(r,t,e,i,s){this.parent=r,this.x=t,this.y=e,this.costSoFar=i,this.simpleDistanceToTarget=s,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},Ht={exports:{}};(function(r,t){(function(){var e,i,s,l,v,S,I,O,x,H,j,E,X,W,q;s=Math.floor,H=Math.min,i=function(a,h){return a<h?-1:a>h?1:0},x=function(a,h,f,m,u){var o;if(f==null&&(f=0),u==null&&(u=i),f<0)throw new Error("lo must be non-negative");for(m==null&&(m=a.length);f<m;)o=s((f+m)/2),u(h,a[o])<0?m=o:f=o+1;return[].splice.apply(a,[f,f-f].concat(h)),h},S=function(a,h,f){return f==null&&(f=i),a.push(h),W(a,0,a.length-1,f)},v=function(a,h){var f,m;return h==null&&(h=i),f=a.pop(),a.length?(m=a[0],a[0]=f,q(a,0,h)):m=f,m},O=function(a,h,f){var m;return f==null&&(f=i),m=a[0],a[0]=h,q(a,0,f),m},I=function(a,h,f){var m;return f==null&&(f=i),a.length&&f(a[0],h)<0&&(m=[a[0],h],h=m[0],a[0]=m[1],q(a,0,f)),h},l=function(a,h){var f,m,u,o,n,b;for(h==null&&(h=i),o=(function(){b=[];for(var C=0,k=s(a.length/2);0<=k?C<k:C>k;0<=k?C++:C--)b.push(C);return b}).apply(this).reverse(),n=[],m=0,u=o.length;m<u;m++)f=o[m],n.push(q(a,f,h));return n},X=function(a,h,f){var m;if(f==null&&(f=i),m=a.indexOf(h),m!==-1)return W(a,0,m,f),q(a,m,f)},j=function(a,h,f){var m,u,o,n,b;if(f==null&&(f=i),u=a.slice(0,h),!u.length)return u;for(l(u,f),b=a.slice(h),o=0,n=b.length;o<n;o++)m=b[o],I(u,m,f);return u.sort(f).reverse()},E=function(a,h,f){var m,u,o,n,b,C,k,D,L;if(f==null&&(f=i),h*10<=a.length){if(o=a.slice(0,h).sort(f),!o.length)return o;for(u=o[o.length-1],k=a.slice(h),n=0,C=k.length;n<C;n++)m=k[n],f(m,u)<0&&(x(o,m,0,null,f),o.pop(),u=o[o.length-1]);return o}for(l(a,f),L=[],b=0,D=H(h,a.length);0<=D?b<D:b>D;0<=D?++b:--b)L.push(v(a,f));return L},W=function(a,h,f,m){var u,o,n;for(m==null&&(m=i),u=a[f];f>h;){if(n=f-1>>1,o=a[n],m(u,o)<0){a[f]=o,f=n;continue}break}return a[f]=u},q=function(a,h,f){var m,u,o,n,b;for(f==null&&(f=i),u=a.length,b=h,o=a[h],m=2*h+1;m<u;)n=m+1,n<u&&!(f(a[m],a[n])<0)&&(m=n),a[h]=a[m],h=m,m=2*h+1;return a[h]=o,W(a,b,h,f)},e=function(){a.push=S,a.pop=v,a.replace=O,a.pushpop=I,a.heapify=l,a.updateItem=X,a.nlargest=j,a.nsmallest=E;function a(h){this.cmp=h??i,this.nodes=[]}return a.prototype.push=function(h){return S(this.nodes,h,this.cmp)},a.prototype.pop=function(){return v(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(h){return this.nodes.indexOf(h)!==-1},a.prototype.replace=function(h){return O(this.nodes,h,this.cmp)},a.prototype.pushpop=function(h){return I(this.nodes,h,this.cmp)},a.prototype.heapify=function(){return l(this.nodes,this.cmp)},a.prototype.updateItem=function(h){return X(this.nodes,h,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return this.nodes.length===0},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var h;return h=new a,h.nodes=this.nodes.slice(0),h},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),function(a,h){return r.exports=h()}(this,function(){return e})}).call(Nt)})(Ht);var ie=Ht.exports,se=ie,M={},ne=te,oe=ee,re=se;const ae=0,le=1;var ue=M,ce=1;M.js=function(){var r=1,t=1.4,e=!1,i={},s,l={},v={},S={},I=!0,O,x={},H=[],j=Number.MAX_VALUE,E,X=!1;this.setAcceptableTiles=function(u){u instanceof Array?E=u:!isNaN(parseFloat(u))&&isFinite(u)&&(E=[u])},this.enableSync=function(){e=!0},this.disableSync=function(){e=!1},this.enableDiagonals=function(){X=!0},this.disableDiagonals=function(){X=!1},this.setGrid=function(u){s=u;for(var o=0;o<s.length;o++)for(var n=0;n<s[0].length;n++)l[s[o][n]]||(l[s[o][n]]=1)},this.setTileCost=function(u,o){l[u]=o},this.setAdditionalPointCost=function(u,o,n){v[o]===void 0&&(v[o]={}),v[o][u]=n},this.removeAdditionalPointCost=function(u,o){v[o]!==void 0&&delete v[o][u]},this.removeAllAdditionalPointCosts=function(){v={}},this.setDirectionalCondition=function(u,o,n){S[o]===void 0&&(S[o]={}),S[o][u]=n},this.removeAllDirectionalConditions=function(){S={}},this.setIterationsPerCalculation=function(u){j=u},this.avoidAdditionalPoint=function(u,o){i[o]===void 0&&(i[o]={}),i[o][u]=1},this.stopAvoidingAdditionalPoint=function(u,o){i[o]!==void 0&&delete i[o][u]},this.enableCornerCutting=function(){I=!0},this.disableCornerCutting=function(){I=!1},this.stopAvoidingAllAdditionalPoints=function(){i={}},this.findPath=function(u,o,n,b,C){var k=function(Pt){e?C(Pt):setTimeout(function(){C(Pt)})};if(E===void 0)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(s===void 0)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(u<0||o<0||n<0||b<0||u>s[0].length-1||o>s.length-1||n>s[0].length-1||b>s.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(u===n&&o===b){k([]);return}for(var D=s[b][n],L=!1,rt=0;rt<E.length;rt++)if(D===E[rt]){L=!0;break}if(L===!1){k(null);return}var B=new ne;B.openList=new re(function(Pt,Ut){return Pt.bestGuessDistance()-Ut.bestGuessDistance()}),B.isDoneCalculating=!1,B.nodeHash={},B.startX=u,B.startY=o,B.endX=n,B.endY=b,B.callback=k,B.openList.push(f(B,B.startX,B.startY,null,r));var Kt=ce++;return x[Kt]=B,H.push(Kt),Kt},this.cancelPath=function(u){return u in x?(delete x[u],!0):!1},this.calculate=function(){if(!(H.length===0||s===void 0||E===void 0))for(O=0;O<j;O++){if(H.length===0)return;e&&(O=0);var u=H[0],o=x[u];if(typeof o>"u"){H.shift();continue}if(o.openList.size()===0){o.callback(null),delete x[u],H.shift();continue}var n=o.openList.pop();if(o.endX===n.x&&o.endY===n.y){var b=[];b.push({x:n.x,y:n.y});for(var C=n.parent;C!=null;)b.push({x:C.x,y:C.y}),C=C.parent;b.reverse();var k=b;o.callback(k),delete x[u],H.shift();continue}n.list=ae,n.y>0&&W(o,n,0,-1,r*h(n.x,n.y-1)),n.x<s[0].length-1&&W(o,n,1,0,r*h(n.x+1,n.y)),n.y<s.length-1&&W(o,n,0,1,r*h(n.x,n.y+1)),n.x>0&&W(o,n,-1,0,r*h(n.x-1,n.y)),X&&(n.x>0&&n.y>0&&(I||q(s,E,n.x,n.y-1,n)&&q(s,E,n.x-1,n.y,n))&&W(o,n,-1,-1,t*h(n.x-1,n.y-1)),n.x<s[0].length-1&&n.y<s.length-1&&(I||q(s,E,n.x,n.y+1,n)&&q(s,E,n.x+1,n.y,n))&&W(o,n,1,1,t*h(n.x+1,n.y+1)),n.x<s[0].length-1&&n.y>0&&(I||q(s,E,n.x,n.y-1,n)&&q(s,E,n.x+1,n.y,n))&&W(o,n,1,-1,t*h(n.x+1,n.y-1)),n.x>0&&n.y<s.length-1&&(I||q(s,E,n.x,n.y+1,n)&&q(s,E,n.x-1,n.y,n))&&W(o,n,-1,1,t*h(n.x-1,n.y+1)))}};var W=function(u,o,n,b,C){var k=o.x+n,D=o.y+b;if((i[D]===void 0||i[D][k]===void 0)&&q(s,E,k,D,o)){var L=f(u,k,D,o,C);L.list===void 0?(L.list=le,u.openList.push(L)):o.costSoFar+C<L.costSoFar&&(L.costSoFar=o.costSoFar+C,L.parent=o,u.openList.updateItem(L))}},q=function(u,o,n,b,C){var k=S[b]&&S[b][n];if(k){var D=a(C.x-n,C.y-b),L=function(){for(var B=0;B<k.length;B++)if(k[B]===D)return!0;return!1};if(!L())return!1}for(var rt=0;rt<o.length;rt++)if(u[b][n]===o[rt])return!0;return!1},a=function(u,o){if(u===0&&o===-1)return M.TOP;if(u===1&&o===-1)return M.TOP_RIGHT;if(u===1&&o===0)return M.RIGHT;if(u===1&&o===1)return M.BOTTOM_RIGHT;if(u===0&&o===1)return M.BOTTOM;if(u===-1&&o===1)return M.BOTTOM_LEFT;if(u===-1&&o===0)return M.LEFT;if(u===-1&&o===-1)return M.TOP_LEFT;throw new Error("These differences are not valid: "+u+", "+o)},h=function(u,o){return v[o]&&v[o][u]||l[s[o][u]]},f=function(u,o,n,b,C){if(u.nodeHash[n]!==void 0){if(u.nodeHash[n][o]!==void 0)return u.nodeHash[n][o]}else u.nodeHash[n]={};var k=m(o,n,u.endX,u.endY);if(b!==null)var D=b.costSoFar+C;else D=0;var L=new oe(b,o,n,D,k);return u.nodeHash[n][o]=L,L},m=function(u,o,n,b){if(X){var C=Math.abs(u-n),k=Math.abs(o-b);return C<k?t*C+k:t*k+C}else{var C=Math.abs(u-n),k=Math.abs(o-b);return C+k}}};M.TOP="TOP";M.TOP_RIGHT="TOP_RIGHT";M.RIGHT="RIGHT";M.BOTTOM_RIGHT="BOTTOM_RIGHT";M.BOTTOM="BOTTOM";M.BOTTOM_LEFT="BOTTOM_LEFT";M.LEFT="LEFT";M.TOP_LEFT="TOP_LEFT";var he=Object.defineProperty,fe=(r,t,e)=>t in r?he(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,P=(r,t,e)=>(fe(r,typeof t!="symbol"?t+"":t,e),e);class qt{constructor(t){P(this,"_onPressed"),P(this,"_onPressedWithRepeat"),P(this,"_onReleased"),P(this,"_isPressed"),P(this,"_identity"),this._isPressed=!1,this._identity=t,typeof t=="function"?this._onPressedWithRepeat=t:(this._onPressed=t.onPressed,this._onPressedWithRepeat=t.onPressedWithRepeat,this._onReleased=t.onReleased)}get isEmpty(){return!this._onPressed&&!this._onPressedWithRepeat&&!this._onReleased}isOwnHandler(t){return this._identity===t}executePressed(t){var e,i;this._isPressed||(e=this._onPressed)==null||e.call(this,t),this._isPressed=!0,(i=this._onPressedWithRepeat)==null||i.call(this,t)}executeReleased(t){var e;this._isPressed&&((e=this._onReleased)==null||e.call(this,t)),this._isPressed=!1}}const At=class Q{constructor(t,e,i={}){P(this,"_normalizedKeyCombo"),P(this,"_parsedKeyCombo"),P(this,"_handlerState"),P(this,"_keyComboEventMapper"),P(this,"_movingToNextSequenceAt"),P(this,"_sequenceIndex"),P(this,"_unitIndex"),P(this,"_lastActiveKeyPresses"),P(this,"_lastActiveKeyCount"),P(this,"_isPressedWithFinalUnit"),this._normalizedKeyCombo=Q.normalizeKeyCombo(t),this._parsedKeyCombo=Q.parseKeyCombo(t),this._handlerState=new qt(i),this._keyComboEventMapper=e,this._movingToNextSequenceAt=0,this._sequenceIndex=0,this._unitIndex=0,this._lastActiveKeyPresses=[],this._lastActiveKeyCount=0,this._isPressedWithFinalUnit=null}static parseKeyCombo(t){if(Q._parseCache[t])return Q._parseCache[t];const e=t.toLowerCase();let i="",s=[],l=[s],v=[l];const S=[v];let I=!1;for(let x=0;x<t.length;x+=1)if(e[x]==="\\")I=!0;else if((e[x]==="+"||e[x]===">"||e[x]===",")&&!I){if(i)throw new Error("cannot have two operators in a row");i=e[x]}else e[x].match(/[^\s]/)&&(i&&(i===","?(s=[],l=[s],v=[l],S.push(v)):i===">"?(s=[],l=[s],v.push(l)):i==="+"&&(s=[],l.push(s)),i=""),I=!1,s.push(e[x]));const O=S.map(x=>x.map(H=>H.map(j=>j.join(""))));return Q._parseCache[t]=O,O}static stringifyKeyCombo(t){return t.map(e=>e.map(i=>i.map(s=>s==="+"?"\\+":s===">"?"\\>":s===","?"\\,":s).join("+")).join(">")).join(",")}static normalizeKeyCombo(t){if(Q._normalizationCache[t])return Q._normalizationCache[t];const e=this.stringifyKeyCombo(this.parseKeyCombo(t));return Q._normalizationCache[t]=e,e}get isPressed(){return!!this._isPressedWithFinalUnit}get sequenceIndex(){return this.isPressed?this._parsedKeyCombo.length:this._sequenceIndex}isOwnHandler(t){return this._handlerState.isOwnHandler(t)}executePressed(t){var e;(e=this._isPressedWithFinalUnit)!=null&&e.has(t.key)&&this._handlerState.executePressed(this._wrapEvent(this._lastActiveKeyPresses,{key:t.key,event:t}))}executeReleased(t){var e;(e=this._isPressedWithFinalUnit)!=null&&e.has(t.key)&&(this._handlerState.executeReleased(this._wrapEvent(this._lastActiveKeyPresses,{key:t.key,event:t})),this._isPressedWithFinalUnit=null)}updateState(t,e){const i=t.length,s=i<this._lastActiveKeyCount;this._lastActiveKeyCount=i;const l=this._parsedKeyCombo[this._sequenceIndex],v=l.slice(0,this._unitIndex),S=l.slice(this._unitIndex),I=()=>{this._movingToNextSequenceAt=0,this._sequenceIndex=0,this._unitIndex=0,this._lastActiveKeyPresses.length=0,this._handlerState.isEmpty&&(this._isPressedWithFinalUnit=null)};let O=0;if(s){if(this._movingToNextSequenceAt===0)return I();if(this._movingToNextSequenceAt+e<Date.now()||i!==0)return;this._movingToNextSequenceAt=0,this._sequenceIndex+=1,this._unitIndex=0;return}for(const x of v){for(const H of x){let j=!1;for(let E=O;E<t.length&&E<O+x.length;E+=1)if(t[E].key===H){j=!0;break}if(!j)return I()}O+=x.length}if(this._movingToNextSequenceAt===0){for(const x of S){for(const H of x){let j=!1;for(let E=O;E<t.length&&E<O+x.length;E+=1)if(t[E].key===H){j=!0;break}if(!j)return}this._unitIndex+=1,O+=x.length}if(O<i-1)return I();if(this._lastActiveKeyPresses[this._sequenceIndex]=t.slice(0),this._sequenceIndex<this._parsedKeyCombo.length-1){this._movingToNextSequenceAt=Date.now();return}this._isPressedWithFinalUnit=new Set(l[l.length-1])}}_wrapEvent(t,e){return{...this._keyComboEventMapper(t,e),keyCombo:this._normalizedKeyCombo,keyEvents:t.flat().map(i=>i.event),finalKeyEvent:e.event}}};P(At,"_parseCache",{}),P(At,"_normalizationCache",{});let it=At;const pe={addEventListener:(...r)=>{},removeEventListener:(...r)=>{},dispatchEvent:(...r)=>{}},de={userAgent:""},vt=()=>typeof document<"u"?document:pe,ye=()=>typeof navigator<"u"?navigator:de,me=()=>ye().userAgent.toLocaleLowerCase().includes("mac");let Ot=!1;const ve=r=>{!me()||r.key!=="Meta"||(Ot=!0)},ge=r=>{!Ot||r.key!=="Meta"||(Ot=!1,jt())},St=new Map,be=r=>{St.set(r.key,r)},we=r=>{St.delete(r.key)},jt=()=>{for(const r of St.values()){const t=new KeyboardEvent("keyup",{key:r.key,code:r.code,bubbles:!0,cancelable:!0});vt().dispatchEvent(t)}St.clear()},xe=r=>{try{const t=()=>r();return addEventListener("focus",t),()=>{removeEventListener("focus",t)}}catch{}},Pe=r=>{try{const t=()=>{jt(),r()};return addEventListener("blur",t),()=>removeEventListener("blur",t)}catch{}},Ce=r=>{try{const t=e=>(be(e),ve(e),r({key:e.key,originalEvent:e,composedPath:()=>e.composedPath(),preventDefault:()=>e.preventDefault()}));return vt().addEventListener("keydown",t),()=>vt().removeEventListener("keydown",t)}catch{}},Te=r=>{try{const t=e=>(we(e),ge(e),r({key:e.key,originalEvent:e,composedPath:()=>e.composedPath(),preventDefault:()=>e.preventDefault()}));return vt().addEventListener("keyup",t),()=>vt().removeEventListener("keyup",t)}catch{}},Se=1e3;class ke{constructor(t={}){P(this,"sequenceTimeout"),P(this,"_isActive"),P(this,"_unbinder"),P(this,"_onActiveBinder"),P(this,"_onInactiveBinder"),P(this,"_onKeyPressedBinder"),P(this,"_onKeyReleasedBinder"),P(this,"_keyComboEventMapper"),P(this,"_selfReleasingKeys"),P(this,"_keyRemap"),P(this,"_handlerStates"),P(this,"_keyComboStates"),P(this,"_keyComboStatesArray"),P(this,"_activeKeyPresses"),P(this,"_activeKeyMap"),P(this,"_watchedKeyComboStates"),this.sequenceTimeout=Se,this._isActive=!0,this._onActiveBinder=()=>{},this._onInactiveBinder=()=>{},this._onKeyPressedBinder=()=>{},this._onKeyReleasedBinder=()=>{},this._keyComboEventMapper=()=>({}),this._selfReleasingKeys=[],this._keyRemap={},this._handlerStates={},this._keyComboStates={},this._keyComboStatesArray=[],this._activeKeyPresses=[],this._activeKeyMap=new Map,this._watchedKeyComboStates={},this.bindEnvironment(t)}get pressedKeys(){return this._activeKeyPresses.map(t=>t.key)}bindKey(t,e){var i;t=t.toLowerCase();const s=new qt(e);(i=this._handlerStates)[t]??(i[t]=[]),this._handlerStates[t].push(s)}unbindKey(t,e){t=t.toLowerCase();const i=this._handlerStates[t];if(i)if(e)for(let s=0;s<i.length;s+=1)i[s].isOwnHandler(e)&&(i.splice(s,1),s-=1);else i.length=0}bindKeyCombo(t,e){var i;t=it.normalizeKeyCombo(t);const s=new it(t,this._keyComboEventMapper,e);(i=this._keyComboStates)[t]??(i[t]=[]),this._keyComboStates[t].push(s),this._keyComboStatesArray.push(s)}unbindKeyCombo(t,e){t=it.normalizeKeyCombo(t);const i=this._keyComboStates[t];if(i)if(e){for(let s=0;s<i.length;s+=1)if(i[s].isOwnHandler(e)){for(let l=0;l<this._keyComboStatesArray.length;l+=1)this._keyComboStatesArray[l]===i[s]&&(this._keyComboStatesArray.splice(l,1),l-=1);i.splice(s,1),s-=1}}else i.length=0}checkKey(t){return this._activeKeyMap.has(t.toLowerCase())}checkKeyCombo(t){return this._ensureCachedKeyComboState(t).isPressed}checkKeyComboSequenceIndex(t){return this._ensureCachedKeyComboState(t).sequenceIndex}bindEnvironment(t={}){this.unbindEnvironment(),this._onActiveBinder=t.onActive??xe,this._onInactiveBinder=t.onInactive??Pe,this._onKeyPressedBinder=t.onKeyPressed??Ce,this._onKeyReleasedBinder=t.onKeyReleased??Te,this._keyComboEventMapper=t.mapKeyComboEvent??(()=>({})),this._selfReleasingKeys=t.selfReleasingKeys??[],this._keyRemap=t.keyRemap??{};const e=this._onActiveBinder(()=>{this._isActive=!0}),i=this._onInactiveBinder(()=>{this._isActive=!1}),s=this._onKeyPressedBinder(v=>{this._handleKeyPress(v)}),l=this._onKeyReleasedBinder(v=>{this._handleKeyRelease(v)});this._unbinder=()=>{e==null||e(),i==null||i(),s==null||s(),l==null||l()}}unbindEnvironment(){var t;(t=this._unbinder)==null||t.call(this)}_ensureCachedKeyComboState(t){t=it.normalizeKeyCombo(t),this._watchedKeyComboStates[t]||(this._watchedKeyComboStates[t]=new it(t,this._keyComboEventMapper));const e=this._watchedKeyComboStates[t];return e.updateState(this._activeKeyPresses,this.sequenceTimeout),e}_handleKeyPress(t){if(!this._isActive)return;t={...t,key:t.key.toLowerCase()};const e=this._keyRemap[t.key];e&&(t.key=e);const i=this._handlerStates[t.key];if(i)for(const l of i)l.executePressed(t);const s=this._activeKeyMap.get(t.key);if(s)s.event=t;else{const l={key:t.key,event:t};this._activeKeyMap.set(t.key,l),this._activeKeyPresses.push(l)}this._updateKeyComboStates();for(const l of this._keyComboStatesArray)l.executePressed(t)}_handleKeyRelease(t){t={...t,key:t.key.toLowerCase()};const e=this._keyRemap[t.key];e&&(t.key=e);const i=this._handlerStates[t.key];if(i)for(const s of i)s.executeReleased(t);if(this._activeKeyMap.has(t.key)){this._activeKeyMap.delete(t.key);for(let s=0;s<this._activeKeyPresses.length;s+=1)if(this._activeKeyPresses[s].key===t.key){this._activeKeyPresses.splice(s,1),s-=1;break}}this._tryReleaseSelfReleasingKeys(),this._updateKeyComboStates();for(const s of this._keyComboStatesArray)s.executeReleased(t)}_updateKeyComboStates(){for(const t of this._keyComboStatesArray)t.updateState(this._activeKeyPresses,this.sequenceTimeout)}_tryReleaseSelfReleasingKeys(){for(const t of this._activeKeyPresses)for(const e of this._selfReleasingKeys)t.key===e&&this._handleKeyRelease(t.event)}}let Ee,Lt;const Ie=r=>{Lt=r??new ke(Ee)},Wt=()=>(Lt||Ie(),Lt),Ke=(...r)=>Wt().bindKey(...r),N=(...r)=>Wt().checkKey(...r);it.normalizeKeyCombo;it.stringifyKeyCombo;it.parseKeyCombo;const tt=class tt{static init(){document.addEventListener("keydown",()=>setTimeout(tt.triggerKeyHoldingFunctions)),window.keyboardLoop=setInterval(tt.triggerKeyHoldingFunctions,200),Ke("shift",{onPressed:()=>{tt.shift.isPressed=!0,U.onPositionChange()},onReleased:()=>{tt.shift.isPressed=!1,U.onPositionChange()}})}};w(tt,"shift",{isPressed:!1}),w(tt,"triggerKeyHoldingFunctions",()=>{(N("ArrowUp")||N("w"))&&window.dispatchEvent(new CustomEvent("move-north")),(N("ArrowDown")||N("s"))&&window.dispatchEvent(new CustomEvent("move-south")),(N("ArrowLeft")||N("a"))&&window.dispatchEvent(new CustomEvent("move-west")),(N("ArrowRight")||N("d"))&&window.dispatchEvent(new CustomEvent("move-east"))});let mt=tt;var T=null;const Ae=function(r){T=r},c=class c{static init(){document.addEventListener("mousemove",t=>{c.recalcMousePosition(t),c.grabbing.initialised&&!c.grabbing.itemId&&c.grabItemFrom({...c.positionServer})},!1),document.addEventListener("mousedown",t=>{c.recalcMousePosition(t),(t.which===1||t.button===0)&&(c.buttons.left.isPressed=!0,c.onLeftButtonPress()),(t.which===3||t.button===2)&&(c.buttons.right.isPressed=!0,c.onRightButtonPress())},!1),document.addEventListener("mouseup",t=>{c.recalcMousePosition(t),(t.which===1||t.button===0)&&(c.buttons.left.isPressed=!1,c.onLeftButtonRelease()),(t.which===3||t.button===2)&&(c.buttons.right.isPressed=!1,c.onRightButtonRelease())},!1),document.addEventListener("contextmenu",t=>(t==null?void 0:t.cancelable)&&t.preventDefault())}static recalcMousePosition(t){const e=y.ctx.canvas.getBoundingClientRect(),i={positionWindow:{...c.positionWindow},positionClient:{...c.positionClient},positionServer:{...c.positionServer}};c.positionWindow={x:t.clientX,y:t.clientY},c.positionCanvas={x:(t.clientX-e.left)/(e.right-e.left)*y.ctx.canvas.width,y:(t.clientY-e.top)/(e.bottom-e.top)*y.ctx.canvas.height},c.positionClient={x:Math.floor((c.positionCanvas.x+T.offset.x)/K),y:Math.floor((c.positionCanvas.y+T.offset.y)/K)},c.positionServer=y.positionClientToServer(c.positionClient),Y(c.positionClient,i.positionClient)||c.onPositionChange(),Y(c.positionServer,i.positionServer)||c.onPositionChange()}static onPositionChange(){if(c.grabbing.itemId)return;if(mt.shift.isPressed){y.ctx.canvas.setAttribute("cursor","eye");return}c.positionServer=y.positionClientToServer(c.positionClient);const t=y.getTileTopItem(c.positionServer);if(!t){y.ctx.canvas.removeAttribute("cursor");return}t===6?y.ctx.canvas.setAttribute("cursor","chest"):t===8?y.ctx.canvas.setAttribute("cursor","pick"):y.ctx.canvas.removeAttribute("cursor")}static onLeftButtonPress(){if(mt.shift.isPressed)return;const t=y.getTileTopItem(c.positionServer);t&&G.get(t).isMovable&&(c.grabbing.itemId=null,c.grabbing.position={x:null,y:null},c.grabbing.initialised=!0)}static onLeftButtonRelease(){if(c.grabbing.initialised&&c.grabbing.itemId)c.releaseItemOn({...c.positionServer});else{const t=$.get("pointer-cross-yellow").clone(),e={sprite:t,position:{...c.positionCanvas}};t.play().then(()=>{c.pointerEffect===e&&(c.pointerEffect=null)}),c.pointerEffect=e,c.grabbing.initialised=!1,c.grabbing.itemId=null,c.grabbing.position={x:null,y:null},lt.setPath(c.positionServer,"walk")}}static onRightButtonPress(){const t={...c.positionServer},e=y.getTileTopItem(t);if(e&&ct(T.position,t)&&G.get(e).isUsable){const i=$.get("pointer-cross-red").clone(),s={sprite:i,position:{...c.positionCanvas}};i.play().then(()=>{c.pointerEffect===s&&(c.pointerEffect=null)}),c.pointerEffect=s,c.use(c.positionServer,e)}}static onRightButtonRelease(){const t=G.get(y.getTileTopItem(c.positionServer));if(t.isUsable&&!ct(T.position,c.positionServer)){const e=$.get("pointer-cross-red").clone(),i={sprite:e,position:{...c.positionCanvas}};e.play().then(()=>{c.pointerEffect===i&&(c.pointerEffect=null)}),c.pointerEffect=i,lt.setPath(c.positionServer,"use",{itemId:t.id})}}static use(t,e){y.getTileTopItem(t)===e&&ct(T.position,t)&&(e===6&&(ut.get("ore-hit").run(t),y.tiles[t.y][t.x].pop(),y.tiles[t.y][t.x].push(9),c.onPositionChange()),e===8&&(ut.get("ore-hit").run(t),y.tiles[t.y][t.x].push(10)),e===9&&ut.get("yellow-sparkles").run(T.position))}static grabItemFrom(t){c.grabbing.itemId=y.getTileTopItem(t),c.grabbing.position=t,y.ctx.canvas.setAttribute("cursor","crosshair")}static releaseItemOn(t){const e={...c.grabbing.position},i={...t},s=c.grabbing.itemId;if(c.grabbing.initialised=!1,c.grabbing.itemId=null,c.grabbing.position={x:null,y:null},c.onPositionChange(),!Y(e,c.positionServer)&&s===y.getTileTopItem(e)){if(!ct(T.position,e)){lt.setPath(e,"move",{itemId:s,positionFrom:e,positionTo:i});return}y.getTileStack(i).find(l=>G.get(l).isBlockingItems)||(y.tiles[e.y][e.x].pop(),y.tiles[i.y][i.x].push(s))}}};w(c,"positionWindow",{x:null,y:null}),w(c,"positionCanvas",{x:null,y:null}),w(c,"positionClient",{x:null,y:null}),w(c,"positionServer",{x:null,y:null}),w(c,"buttons",{left:{isPressed:!1},right:{isPressed:!1}}),w(c,"grabbing",{initialised:!1,itemId:null,position:{x:null,y:null}}),w(c,"pointerEffect",null);let U=c;const p=class p{static init(){p.easyStar=new ue.js,window.addEventListener("move-north",()=>{p.clearPath(),p.walk("north")}),window.addEventListener("move-south",()=>{p.clearPath(),p.walk("south")}),window.addEventListener("move-west",()=>{p.clearPath(),p.walk("west")}),window.addEventListener("move-east",()=>{p.clearPath(),p.walk("east")})}static walk(t){if(T.movement.isMoving)return T.movement.currentFrame>K-K/3?(p.queuedMove=t,!0):!1;const e=p.getTargetPosition(T,t);return y.isWalkable(e)?(p.move(T,e,t),!0):(T.sprite.loop("idle-"+t),!1)}static move(t,e,i){t.movement.timeouts.forEach(s=>clearTimeout(s)),t.movement.timeouts=[],t.currentFrame=0,t.offset={x:0,y:0},t.movement.isMoving=!0;for(let s=0;s<K;s++){const l=setTimeout(()=>p.handleMovingFrame(t,e,i),1e3/t.speed/K*s);t.movement.timeouts.push(l)}}static handleMovingFrame(t,e,i){if(t.sprite.loop("walk-"+i),t.movement.currentFrame++,p.updateOffsetAfterAnimationFrameChange(t,i),t.movement.currentFrame===K/2&&(t.position=e,window.dispatchEvent(new CustomEvent("hero-position-changed")),p.updateOffsetAfterPositionChange(t,i)),t.movement.currentFrame===K){if(t.movement.isMoving=!1,t.movement.currentFrame=0,t.movement.timeouts.forEach(s=>clearTimeout(s)),t.movement.timeouts=[],t.isHero()&&p.queuedMove&&(i=p.queuedMove,p.queuedMove=null,p.walk(i)))return;if(p.path)if(Y(p.path.destination,e))p.clearPath();else{p.makePathStep();return}t.sprite.loop("idle-"+i)}}static getDirection(t,e){if(t.x<e.x)return"east";if(t.x>e.x)return"west";if(t.y>e.y)return"north";if(t.y<e.y)return"south"}static getTargetPosition(t,e){const i={north:{x:0,y:-1},south:{x:0,y:1},west:{x:-1,y:0},east:{x:1,y:0}};return{x:t.position.x+i[e].x,y:t.position.y+i[e].y}}static updateOffsetAfterAnimationFrameChange(t,e){({north:()=>t.offset.y--,south:()=>t.offset.y++,west:()=>t.offset.x--,east:()=>t.offset.x++})[e]()}static updateOffsetAfterPositionChange(t,e){({north:()=>t.offset.y=K/2,south:()=>t.offset.y=-(K/2),west:()=>t.offset.x=K/2,east:()=>t.offset.x=-(K/2)})[e]()}static clearPath(){p.path=null}static setPath(t,e,i=null){p.path={destination:{...t},action:e,actionData:i},T.movement.isMoving||p.makePathStep()}static makePathStep(){if(!p.path||Y(p.path.destination,T.position)){p.path=null,T.sprite.loop("idle-south");return}const t=[],e=y.positionServerToClient(T.position),i=y.positionServerToClient(p.path.destination);for(let s=y.firstTilePosition.y;s<=y.lastTilePosition.y;s++){const l=[];for(let v=y.firstTilePosition.x;v<=y.lastTilePosition.x;v++){const S={x:v,y:s};let I=Y(p.path.destination,S)?!0:y.isWalkable(S);l.push(Number(I))}t.push(l)}p.easyStar.setGrid(t),p.easyStar.setAcceptableTiles([1]),p.easyStar.findPath(e.x,e.y,i.x,i.y,s=>{if(s===null){console.log("Path was not found.");return}if(p.path.action==="use"&&(s.length===2||ct(T.position,p.path.destination))){T.sprite.loop("idle-south"),U.use(p.path.destination,p.path.actionData.itemId),p.clearPath();return}if(p.path.action==="move"&&(s.length===2||ct(T.position,p.path.destination))){T.sprite.loop("idle-south"),p.path.actionData.itemId===y.getTileTopItem(p.path.actionData.positionFrom)&&(U.grabItemFrom(p.path.actionData.positionFrom),U.releaseItemOn(p.path.actionData.positionTo)),p.clearPath();return}p.walk(p.getDirection(e,s[1]))||p.clearPath()}),p.easyStar.calculate()}};w(p,"queuedMove",null),w(p,"easyStar",null),w(p,"path",null);let lt=p;class Gt{constructor(t,e,i){w(this,"position",{x:null,y:null});w(this,"offset",{x:null,y:null});w(this,"sprite",null);w(this,"speed",2);w(this,"movement",{isMoving:!1,currentFrame:0,timeouts:[]});y.creatures[t]=this,this.position=e,this.offset=i,this.sprite=$.get("outfit").clone(),this.sprite.dye([Tt(),Tt(),Tt(),Tt()]),this.sprite.loop("idle-south")}isHero(){return this===T}move(t,e){lt.move(this,e,t)}}const d=class d{static init(){const t=document.createElement("canvas");t.id="board",t.width=K*Rt,t.height=K*Mt,document.querySelector("#app").append(t),d.ctx=t.getContext("2d"),d.width=Rt,d.height=Mt,d.update(),window.addEventListener("hero-position-changed",()=>{d.update()})}static update(){d.firstTilePosition={x:T.position.x-Math.floor(d.width/2),y:T.position.y-Math.floor(d.height/2)},d.lastTilePosition={x:T.position.x+Math.floor(d.width/2),y:T.position.y+Math.floor(d.height/2)};for(const[i,s]of Object.entries(d.creatures))d.isOnArea(s.position)||delete d.creatures[i];const t=[],e={};for(let i=d.firstTilePosition.y;i<=d.lastTilePosition.y;i++)for(let s=d.firstTilePosition.x;s<=d.lastTilePosition.x;s++)e[i]=e[i]||{},d.tiles[i]&&d.tiles[i][s]?e[i][s]=d.tiles[i][s]:(e[i][s]=[],t.push({x:s,y:i}));d.tiles=e,d.requestTiles(t)}static getTileStack(t){return typeof d.tiles[t.y]>"u"||typeof d.tiles[t.y][t.x]>"u"?[]:d.tiles[t.y][t.x]}static getTileTopItem(t){const e=d.getTileStack(t);return e[e.length-1]??null}static updateTile(t,e){typeof d.tiles[t.y]<"u"&&typeof d.tiles[t.y][t.x]<"u"&&(d.tiles[t.y][t.x]=e)}static requestTiles(t){setTimeout(()=>{for(const e of t){const i=[];_(40)?i.push(2):_(40)?i.push(3):_(30)?i.push(4):i.push(1),Y(e,T.position)||(_(100)?i.push(6):_(100)?i.push(8):_(100)?i.push(5):_(100)&&i.push(7)),d.updateTile(e,i),_(350)&&new Gt(Yt(20),e,{x:0,y:0})}},100)}static isWalkable(t){const e=d.getTileStack(t);return!(!e.find(i=>G.get(i).type==="ground")||e.find(i=>G.get(i).isBlockingCreatures))}static isOnArea(t){return t.x>=d.firstTilePosition.x&&t.x<=d.lastTilePosition.x&&t.y>=d.firstTilePosition.y&&t.y<=d.lastTilePosition.y}static positionClientToServer(t){return{x:t.x+d.firstTilePosition.x,y:t.y+d.firstTilePosition.y}}static positionServerToClient(t){return{x:t.x-d.firstTilePosition.x,y:t.y-d.firstTilePosition.y}}static getVisibleEffectsSprites(t){return d.effects&&d.effects[t.y]&&d.effects[t.y][t.x]?Object.values(this.effects[t.y][t.x]):[]}};w(d,"ctx",null),w(d,"width",null),w(d,"height",null),w(d,"firstTilePosition",{}),w(d,"lastTilePosition",{}),w(d,"tiles",{}),w(d,"effects",{}),w(d,"creatures",{});let y=d;var wt,Et,It,xt;const et=class et{constructor(t,e){F(this,It,null);F(this,xt,null);g(et,wt)[t]=this,A(this,It,t),A(this,xt,e)}static async load(t){try{const i=await(await fetch(t)).json();return new Promise(s=>{Object.values(i).forEach(l=>{new et(l.id,$.get(l.sprite))}),s()})}catch(e){console.error("Error loading effects:",e)}}static get(t){return g(et,wt)[t]??null}run(t){y.effects[t.y]||(y.effects[t.y]={}),y.effects[t.y][t.x]||(y.effects[t.y][t.x]={});const e=++Ct(et,Et)._,i=g(this,xt).clone();y.effects[t.y][t.x][e]=i,i.play().then(()=>{delete y.effects[t.y][t.x][e]})}};wt=new WeakMap,Et=new WeakMap,It=new WeakMap,xt=new WeakMap,F(et,wt,{}),F(et,Et,0);let ut=et;class R{static renderTile(t,e,i,s){i==="ground"&&s.forEach(l=>{G.get(l).type==="ground"&&R.drawSprite(t,G.get(l).sprite)}),i==="objects"&&(s.forEach(l=>{const v=G.get(l);v.type==="object"&&R.drawSprite(t,v.sprite)}),mt.shift.isPressed&&Y(t,U.positionClient)&&R.drawSprite(t,$.get("cursor")),Object.values(y.creatures).forEach(l=>{Y(e,l.position)&&R.drawCreature(t,l)}),y.getVisibleEffectsSprites(e).forEach(l=>{R.drawSprite(t,l)}))}static drawSprite(t,e){const i=e.getFrame(),s=t.y*K+(K-i.height),l=t.x*K+(Math.ceil(K/2)-Math.ceil(i.width/2));R.tempCtx.drawImage(i,l,s)}static drawCreature(t,e){const i=e.sprite.getFrame(),s=t.y*K+(K-i.height)+e.offset.y,l=t.x*K+(Math.ceil(K/2)-Math.ceil(i.width/2))+e.offset.x;R.tempCtx.drawImage(i,l,s)}static cropEdges(t){t.clearRect(0,0,K,t.canvas.height),t.clearRect(0,0,t.canvas.width,K),t.clearRect(t.canvas.width-K,0,t.canvas.width,t.canvas.height),t.clearRect(0,t.canvas.height-K,t.canvas.width,t.canvas.height)}static render(){const t=document.createElement("canvas");t.width=y.ctx.canvas.width,t.height=y.ctx.canvas.height,R.tempCtx=t.getContext("2d"),R.tempCtx.fillStyle="#25131a",R.tempCtx.fillRect(0,0,R.tempCtx.canvas.width,R.tempCtx.canvas.height);for(let e of["ground","objects"]){let i=0;for(let[s,l]of Object.entries(y.tiles)){let v=0;for(let[S,I]of Object.entries(l)){const O={x:v,y:i},x={x:Number(S),y:Number(s)};R.renderTile(O,x,e,I),v++}i++}}R.renderPointerEffect(R.tempCtx),y.ctx.clearRect(0,0,y.ctx.canvas.width,y.ctx.canvas.height),y.ctx.drawImage(t,-T.offset.x,-T.offset.y),R.cropEdges(y.ctx),window.requestAnimationFrame(R.render)}static renderPointerEffect(t){if(!U.pointerEffect)return;const e=U.pointerEffect.sprite.getFrame(),i=U.pointerEffect.position,s=T.offset;t.drawImage(e,i.x+s.x-e.width/2,i.y+s.y-e.height/2)}}const Oe=async()=>{async function r(){await $.load($t),await G.load(Qt),await ut.load(Zt)}async function t(){mt.init(),U.init(),Ae(new Gt("Nemnes",{x:100,y:100},{x:0,y:0})),lt.init(),y.init(),R.render(),ut.get("energy").run(T.position)}await r(),await t()};Oe();
